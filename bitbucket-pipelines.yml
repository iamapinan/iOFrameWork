image: oneko/php-7.1-node-yarn

pipelines:
  branches:
    master:
      - step:
          name: Build & Deploy
          caches:
            - composer
#          script:
#            - apt-get update && apt-get install -y unzip
#            - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
          deployment: production
          script:
            - echo "Now deploying to iOTech Cloud Server"
            - composer install
            - rsync -azP --exclude .git --exclude .gitignore --exclude bitbucket-pipelines.yml . $DEPLOY_USER@$DEPLOY_HOST:/mnt/data/gbox/app
            - echo "Deploy successfully"